<script>
// ********************************* [ Insertar contacto ]*******************************
  function insertarContacto() {
    limpiar();
    // Obtengo los datos del formulario
    let nombre = document.getElementById("nombre").value;
    let apellido = document.getElementById("apellido").value;
    let correo = document.getElementById("correo").value;
    let telefono = document.getElementById("telefono").value;
    // Cerrar el modal
    bootstrap.Modal.getInstance(
      document.getElementById("modalContacto")
    ).hide();
    // Obtengo los contactos, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoInsertadoOK)
      .withFailureHandler(contactoInsertadoError)
      .insertarContacto(nombre, apellido, correo, telefono);
  }

  function contactoInsertadoOK() {
    // Limpio datos del formulario
    document.getElementById("nombre").value = "";
    document.getElementById("correo").value = "";
    crearNotificacionContacto("Contacto insertado correctamente", "OK");
    mostrar();
  }

  function contactoInsertadoError() {
    crearNotificacionContacto("No se pudo insertar el contacto", "ERROR");
    mostrar();
  }

    // ********************************* [ Modificar Contacto ]*******************************

  function modificarContacto(nFila) {
    limpiar();
    // Cierro el modal
    bootstrap.Modal.getOrCreateInstance(
      document.getElementById("modalContacto")
    ).hide();
    // Obtengo los datos del formulario
    let nombre = document.getElementById("nombre").value;
    let apellido = document.getElementById("apellido").value;
    let correo = document.getElementById("correo").value;
    let telefono = document.getElementById("telefono").value;

    // Modifico el contacto, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoModificadoOk)
      .withFailureHandler(e => contactoModificadoError(e))
      .modificarContacto(nFila, { nombre, apellido, correo, telefono });
  }

  function contactoModificadoOk() {
    crearNotificacionContacto("Contacto modificado correctamente", "OK");
    mostrar();
  }

  function contactoModificadoError(error) {
    crearNotificacionContacto("No se pudo modificar el contacto", "ERROR");
    mostrar();
  }

  // ********************************* [ Eliminar contacto ]*******************************

  function borrarContacto(nFila) {
    limpiar();

    // Borro el contacto, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoBorradoOk)
      .withFailureHandler(contactoBorradoError)
      .eliminarContacto(nFila);
  }

  function contactoBorradoOk() {
    crearNotificacionBorrar("Contacto eliminado correctamente", "OK");
    mostrar();
  }

  function contactoBorradoError() {
    crearNotificacionBorrar("No se pudo borrar el contacto", "ERROR");
    mostrar();
  }

  // ********************************* [ Extraer Contactos ]*******************************
  function extraerContactos(datos){
    let contactos = [];
    for(let i = 1;i<datos.length;i++){
      let contacto = {
        nombre: datos[i][0],
        apellido: datos[i][1],
        email: datos[i][2],
        telefono: datos[i][3],
        imagen: datos[i][4],
        fila: i+1
      }
      contactos.push(contacto);
    }
    return contactos;
  }

  
  // ********************************* [ Extraer columnas ]*******************************
  function extraerColumnas(datos){
    let columnas = [];
    for(let i = 0;i<datos[0].length;i++){
      columnas.push(datos[0][i]);
    }
    columnas.push("OPCIONES");
    return columnas;
  }

</script>