<script>
// ********************************* [ Insertar contacto ]*******************************
  function insertarContacto() {
    limpiar();
    // Obtengo los datos del formulario
    let nombre = document.getElementById("nombre").value;
    let apellido = document.getElementById("apellido").value;
    let correo = document.getElementById("correo").value;
    let telefono = document.getElementById("telefono").value;
    // Cerrar el modal
    bootstrap.Modal.getInstance(
      document.getElementById("modalContacto")
    ).hide();
    // Obtengo los contactos, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoInsertadoOK)
      .withFailureHandler(contactoInsertadoError)
      .insertarContacto(nombre, apellido, correo, telefono);
  }

  function contactoInsertadoOK() {
    // Limpio datos del formulario
    document.getElementById("nombre").value = "";
    document.getElementById("correo").value = "";
    // Elimino la tabla
    limpiar();
    // Muestro el mensaje
    crearNotificacionContacto("Contacto insertado correctamente", "OK");
    //Muestro la tabla
    mostrar();
    // Elimino el loader
  }

  function contactoInsertadoError() {
    // Mostrar notificacion de error
    crearNotificacionContacto("No se pudo insertar el contacto", "ERROR");
    //Muestro la tabla
    mostrar();
  }

    // ********************************* [ Modificar Contacto ]*******************************

  function modificarContacto(nFila) {
    limpiar();
    // Cierro el modal
    bootstrap.Modal.getOrCreateInstance(
      document.getElementById("modalContacto")
    ).hide();
    // Obtengo los datos del formulario
    let nombre = document.getElementById("nombre").value;
    let apellido = document.getElementById("apellido").value;
    let correo = document.getElementById("correo").value;
    let telefono = document.getElementById("telefono").value;

    // Modifico el contacto, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoModificadoOk)
      .withFailureHandler(e => contactoModificadoError(e))
      .modificarContacto(nFila, { nombre, apellido, correo, telefono });
  }

  function contactoModificadoOk() {
    eliminarTablaContactos();
    // Mostrar notificacion
    crearNotificacionContacto("Contacto modificado correctamente", "OK");
    mostrar();
  }

  function contactoModificadoError(error) {
    console.log(error);
    console.log("Entre");
    eliminarTablaContactos();
    // Mostrar notificacion de error
    crearNotificacionContacto("No se pudo modificar el contacto", "ERROR");
    mostrar();
  }

  // ********************************* [ Eliminar contacto ]*******************************

  function borrarContacto(nFila) {
    limpiar();

    // Borro el contacto, si es ok, creo la tabla, sino, devuelvo error
    google.script.run
      .withSuccessHandler(contactoBorradoOk)
      .withFailureHandler(contactoBorradoError)
      .eliminarContacto(nFila);
  }

  function contactoBorradoOk() {
    eliminarTablaContactos();
    // Mostrar notificacion
    crearNotificacionBorrar("Contacto eliminado correctamente", "OK");
    mostrar();
  }

  function contactoBorradoError() {
    eliminarTablaContactos();
    // Mostrar notificacion de error
    crearNotificacionBorrar("No se pudo borrar el contacto", "ERROR");
    mostrar();
  }

</script>